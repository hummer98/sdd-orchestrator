# Response to Document Review #1

**Feature**: impl-mode-toggle
**Review Date**: 2026-01-25
**Reply Date**: 2026-01-25

---

## Response Summary

| Severity | Issues | Fix Required | No Fix Needed | Needs Discussion |
| -------- | ------ | ------------ | ------------- | ---------------- |
| Critical | 0      | 0            | 0             | 0                |
| Warning  | 3      | 0            | 3             | 0                |
| Info     | 2      | 0            | 2             | 0                |

---

## Response to Warnings

### W1: エラーハンドリングの詳細がタスクに明示されていない

**Issue**: Design でエラーハンドリング戦略は記載されているが、Tasks に明示的なエラーハンドリング実装タスクがない。

**Judgment**: **No Fix Needed** ❌

**Evidence**:

既存の `FileService.updateSpecJson` メソッド（`fileService.ts:541-568`）では、既に適切なエラーハンドリングが実装されています。

```typescript
// fileService.ts:541-568
async updateSpecJson(
  specPath: string,
  updates: Record<string, unknown>
): Promise<Result<void, FileError>> {
  try {
    // ... 実装 ...
    return { ok: true, value: undefined };
  } catch (error) {
    return {
      ok: false,
      error: {
        type: 'WRITE_ERROR',
        path: specPath,
        message: String(error),
      },
    };
  }
}
```

- **読み取り失敗のフォールバック**: Design の Error Handling セクション（475-488行）で明記されている「デフォルト `'sequential'` にフォールバック」は、実装タスク 1.1, 1.2 のデフォルト値設定と Task 2.3 のフォールバック処理で対応
- **書き込み失敗の通知**: 既存の `Result<T, E>` 型パターンにより、IPC ハンドラで適切にエラーを Renderer に伝播可能

本機能の実装は既存のエラーハンドリングパターンを再利用するため、個別のエラーハンドリングタスクは不要です。

---

### W2: ユニットテストタスクが限定的

**Issue**: Design の Testing Strategy にユニットテストの方針が記載されているが、Tasks にテストタスクが限定的。

**Judgment**: **No Fix Needed** ❌

**Evidence**:

本プロジェクトでは、各コンポーネントタスクの実装時にテストを含めるのが標準プラクティスです。Tasks の実装タスク（3.1, 3.2, 3.3, 2.2, 2.3）は、それぞれ TDD アプローチで実装されるため、テストは実装の一部として含まれます。

さらに、Tasks 5.2 と 5.3 は明示的に「動作確認テストを作成する」タスクとして定義されています：

- Task 5.2: 「手動実行フローの動作確認テストを作成する」
- Task 5.3: 「自動実行フローの動作確認テストを作成する」

既存のテストファイルを確認:
- `fileService.test.ts` - FileService のテスト
- `autoExecutionCoordinator.test.ts` - AutoExecutionCoordinator のテスト

本機能の実装は既存テストファイルの拡張と Task 5.2/5.3 で十分にカバーされます。

---

### W3: Remote UI DesktopLayout 準拠の確認

**Issue**: tech.md に「Remote UI DesktopLayout設計原則（Strict）」があり、ParallelModeToggle の変更が Remote UI でも同等に適用されることを確認する必要がある。

**Judgment**: **No Fix Needed** ❌

**Evidence**:

Design の Integration & Deprecation Strategy（569-601行）で、この点は既に考慮されています：

1. **共有コンポーネント設計**: `ParallelModeToggle` は `src/shared/components/workflow/` に配置されており、Electron 版と Remote UI 版の両方で同じコンポーネントを使用
2. **Task 4.2**: 「useRemoteWorkflowState で implMode の取得・トグルハンドラを追加する」で Remote UI 対応を明示的にカバー
3. **Task 5.1**: 「WorkflowViewCore に implMode 関連の props を接続する」で Electron 版と Remote UI 版の両方で同一のコンポーネント接続を実装

Requirements Traceability マトリックス（139-161行）でも、Criterion 6.1, 6.2 が Task 4.2 と 5.1 にマッピングされています。

実装後の視覚確認は Task 5.1 の検証プロセスに含まれます。

---

## Response to Info (Low Priority)

| #   | Issue                            | Judgment      | Reason                                                                                            |
| --- | -------------------------------- | ------------- | ------------------------------------------------------------------------------------------------- |
| I1  | アイコンの具体的選択             | No Fix Needed | Design Decision DD-004 で Accepted 済み。`User`/`Users` アイコンを使用。実装時の視覚確認で十分 |
| I2  | deprecated props の削除タイミング | No Fix Needed | Design DD-005 で段階的移行を明記。次期バージョンでの削除は機能スコープ外                        |

---

## Files to Modify

該当なし（修正は不要）

---

## Conclusion

3 件の Warning と 2 件の Info すべてについて、既存コードのパターンや Design ドキュメントの内容を確認した結果、いずれも修正は不要と判断しました。

- **W1 (エラーハンドリング)**: 既存の `FileService.updateSpecJson` が Result 型でエラーを適切に処理
- **W2 (ユニットテスト)**: TDD アプローチと Task 5.2/5.3 で十分にカバー
- **W3 (Remote UI 準拠)**: 共有コンポーネント設計により自動的に準拠、Task 4.2/5.1 で明示的にカバー

**Next Steps**: `/kiro:spec-impl impl-mode-toggle` で実装を開始できます。

---

_This reply was generated by the document-review-reply command._
_Reply Date: 2026-01-25T10:28:01Z_
