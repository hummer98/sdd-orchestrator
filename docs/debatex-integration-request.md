# debatex 改修依頼書

## 概要

SDD Orchestrator のドキュメントレビューワークフローに debatex を統合するため、以下の改修を依頼します。

## 背景

SDD Orchestrator では、ドキュメントレビュープロセスで複数のレビューエンジン（Claude Code、Gemini CLI、debatex）を選択可能にしています。debatex の「複数エージェントによる議論形式レビュー」は、単一 AI では得られない多角的な視点を提供する価値があります。

統合にあたり、sdd-orchestrator 側の既存ワークフロー（`document-review-reply` による修正判断・適用）との互換性を確保する必要があります。

## 依頼事項

### 1. 出力パス指定オプションの追加

**現状**: debatex は `.debatex/logs/sdd-document-review/<topic>/summary.md` に出力

**依頼**: `--output <path>` オプションで出力先を指定可能に

```bash
# 使用例
npx debatex sdd-document-review user-authentication \
  --output .kiro/specs/user-authentication/document-review-1.md
```

**要件**:
- `--output` で指定されたパスに直接出力
- 親ディレクトリが存在しない場合は自動作成
- 既存ファイルがある場合は上書き（sdd-orchestrator 側で番号管理するため衝突しない想定）

### 2. 出力フォーマットの互換性対応

**現状**: debatex の `summary.md` は独自フォーマット（議論の概要、主要な発見事項、合意された改善点、推奨アクション）

**依頼**: sdd-orchestrator の `document-review.md` フォーマットと互換性のある出力を生成

**必須セクション**:

```markdown
# Specification Review Report #{n}

**Feature**: {feature-name}
**Review Date**: {YYYY-MM-DD}
**Documents Reviewed**: {list of reviewed files}

## Executive Summary

{Review result summary: Critical/Warning/Info counts}

## 1. Document Consistency Analysis

### 1.1 Requirements ↔ Design Alignment
{Contradictions and gaps detail}

### 1.2 Design ↔ Tasks Alignment
{Contradictions and gaps detail}

### 1.3 Design ↔ Tasks Completeness
{Missing components analysis}

### 1.4 Acceptance Criteria → Tasks Coverage
{CRITICAL CHECK}

### 1.5 Cross-Document Contradictions
{List of contradictions between documents}

## 2. Gap Analysis

### 2.1 Technical Considerations
{List of technical gaps}

### 2.2 Operational Considerations
{List of operational gaps}

## 3. Ambiguities and Unknowns

{List of vague descriptions and undefined items}

## 4. Steering Alignment

### 4.1 Architecture Compatibility
{Analysis}

### 4.2 Integration Concerns
{Concerns}

### 4.3 Migration Requirements
{Requirements}

## 5. Recommendations

### Critical Issues (Must Fix)
{List}

### Warnings (Should Address)
{List}

### Suggestions (Nice to Have)
{List}

## 6. Action Items

| Priority | Issue | Recommended Action | Affected Documents |
| -------- | ----- | ------------------ | ------------------ |
| ...      | ...   | ...                | ...                |

---

## Appendix: Discussion Log

<details>
<summary>議論の詳細（展開するにはクリック）</summary>

### ターン 1: 要件アナリスト
{発言内容}

### ターン 2: アーキテクト
{発言内容}

...

</details>

---

_This review was generated by debatex sdd-document-review preset._
```

**ポイント**:
- 各エージェントの指摘を適切なセクション（Critical/Warnings/Suggestions）に分類
- 議論過程は `<details>` タグで折りたたみ、本文を簡潔に
- `document-review-reply` が解析できる形式を維持

### 3. レビュー番号の受け取り（オプション）

**依頼**: `--review-number <n>` オプションでレビュー番号を指定可能に

```bash
npx debatex sdd-document-review user-authentication \
  --output .kiro/specs/user-authentication/document-review-2.md \
  --review-number 2
```

**用途**: 出力ファイル内の `# Specification Review Report #{n}` に反映

**代替案**: sdd-orchestrator 側で出力ファイルを後処理して番号を挿入することも可能。この場合、本オプションは不要。

## 優先度

| 項目 | 優先度 | 理由 |
|------|--------|------|
| 出力パス指定 | 高 | これがないと `.kiro/specs/` への統合ができない |
| 出力フォーマット互換 | 高 | `document-review-reply` との連携に必須 |
| レビュー番号受け取り | 低 | sdd-orchestrator 側での後処理でも対応可能 |

## テスト方法

統合テストは以下の手順で実施予定：

1. sdd-orchestrator で scheme を `debatex` に設定
2. ドキュメントレビュー実行
3. 出力が `.kiro/specs/<feature>/document-review-{n}.md` に生成されることを確認
4. `document-review-reply` で出力を解析できることを確認
5. 修正適用後、再レビューが正常に動作することを確認

## 連絡先

質問・確認事項があれば sdd-orchestrator リポジトリの Issue または直接ご連絡ください。

---

作成日: 2026-01-17
