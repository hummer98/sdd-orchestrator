# Requirements Document

## Introduction

SDD Managerにマルチウィンドウ機能を実装する。1つのウィンドウで1つのプロジェクトを開き、複数のプロジェクトを同時に管理できるようにする。ツール系メニューはフォーカス中のウィンドウのコンテキストに追従し、同一プロジェクトの重複オープンを防止し、アプリ再起動時には前回のウィンドウ状態を復元する。

## Requirements

### Requirement 1: マルチウィンドウによる複数プロジェクト管理

**Objective:** ユーザーとして、複数のプロジェクトを同時に開いて管理したい。それにより、プロジェクト間の切り替えなしで並行して作業できる。

#### Acceptance Criteria

1. When ユーザーが「新しいウィンドウを開く」メニューまたはショートカットを実行した場合, the SDD Manager shall 新しいウィンドウを作成してプロジェクト選択画面を表示する
2. When ユーザーが新しいウィンドウでプロジェクトを選択した場合, the SDD Manager shall 選択されたプロジェクトをそのウィンドウで開く
3. The SDD Manager shall 各ウィンドウのタイトルにプロジェクト名（またはディレクトリ名）を表示する
4. When ウィンドウが閉じられた場合, the SDD Manager shall そのウィンドウに関連するリソースを解放する
5. While 複数のウィンドウが開いている状態で, when 最後のウィンドウが閉じられた場合, the SDD Manager shall アプリケーションを終了する（macOSの場合はメニューバーのみ残す）

### Requirement 2: ツール系メニューのウィンドウ追従

**Objective:** ユーザーとして、ツール系メニューが現在フォーカスしているウィンドウのプロジェクトに対して動作してほしい。それにより、意図しないプロジェクトに対する操作を防止できる。

#### Acceptance Criteria

1. When ウィンドウがフォーカスを受け取った場合, the SDD Manager shall メニューバーのコンテキストをそのウィンドウのプロジェクトに切り替える
2. While ウィンドウがフォーカスされている状態で, when ユーザーがメニューからSpec操作（作成・承認等）を実行した場合, the SDD Manager shall フォーカス中のウィンドウのプロジェクトに対してその操作を実行する
3. While プロジェクトが開かれていないウィンドウがフォーカスされている状態で, the SDD Manager shall プロジェクト固有のメニュー項目を無効化する
4. The SDD Manager shall メニューバーに現在アクティブなプロジェクト名を表示する（または識別可能な状態にする）

### Requirement 3: 同一プロジェクトの重複オープン防止

**Objective:** ユーザーとして、同じプロジェクトを誤って複数のウィンドウで開くことを防止したい。それにより、データの不整合や混乱を避けられる。

#### Acceptance Criteria

1. When ユーザーが既に別のウィンドウで開かれているプロジェクトを選択した場合, the SDD Manager shall 新しいウィンドウを開かず、既存のウィンドウをフォーカスする
2. When 既存のウィンドウが最小化されている状態で重複オープンが試みられた場合, the SDD Manager shall そのウィンドウを復元してからフォーカスする
3. The SDD Manager shall 開いているプロジェクトのパスを内部的に管理し、重複チェックを行う
4. When ドラッグ＆ドロップまたはコマンドライン引数で既に開いているプロジェクトが指定された場合, the SDD Manager shall 既存のウィンドウをフォーカスする

### Requirement 4: ウィンドウ状態の永続化と復元

**Objective:** ユーザーとして、アプリ再起動時に前回のウィンドウ配置と開いていたプロジェクトが復元されてほしい。それにより、作業環境を毎回再構築する手間を省ける。

#### Acceptance Criteria

1. When アプリケーションが終了する場合, the SDD Manager shall 全ウィンドウの状態（位置、サイズ、開いているプロジェクトパス）を永続化する
2. When アプリケーションが起動した場合, the SDD Manager shall 前回終了時のウィンドウ状態を復元する
3. If 復元対象のプロジェクトディレクトリが存在しない場合, the SDD Manager shall そのウィンドウをスキップし、ユーザーに通知する
4. While 初回起動または状態ファイルが存在しない場合, the SDD Manager shall デフォルトのウィンドウサイズと位置で1つのウィンドウを開く
5. The SDD Manager shall ウィンドウの最大化・最小化状態も復元する
6. When マルチディスプレイ環境で、前回のディスプレイが存在しない場合, the SDD Manager shall プライマリディスプレイにウィンドウを配置する

### Requirement 5: ウィンドウ間の一貫性

**Objective:** ユーザーとして、各ウィンドウが独立して動作しつつ、アプリケーション全体として一貫した体験を得たい。それにより、どのウィンドウでも同じ操作感で作業できる。

#### Acceptance Criteria

1. The SDD Manager shall 全てのウィンドウで同一のUIコンポーネントとスタイルを使用する
2. When アプリケーション設定が変更された場合, the SDD Manager shall 全ての開いているウィンドウにその変更を反映する
3. The SDD Manager shall 各ウィンドウのエージェントプロセスを独立して管理する
4. While 複数のウィンドウで同時にエージェントが実行されている場合, the SDD Manager shall 各エージェントを独立して監視・制御する
