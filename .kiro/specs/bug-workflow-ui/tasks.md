# Implementation Plan

## Task Overview

Bug Workflow UIの実装タスク。サイドバーにバグ管理機能を追加し、Spec一覧とバグ一覧のタブ切り替え、バグのワークフロー進捗表示、UIからのバグワークフローコマンド実行を実現する。

---

## Tasks

- [x] 1. バグデータモデルとIPC APIの実装
- [x] 1.1 (P) バグ関連の型定義を追加
  - BugMetadata、BugPhase、BugDetail、BugsChangeEventの型を定義
  - フェーズ判定ロジック（determineBugPhase）のユーティリティ関数を実装
  - バグ関連の型をelectron.d.tsに追加（readBugs、readBugDetail、watcher API等）
  - _Requirements: 3.1, 6.1_

- [x] 1.2 (P) Main Process側のバグ読み込みサービスを実装
  - .kiro/bugs/ディレクトリからバグ一覧を読み込む機能
  - 各バグのbug.jsonからメタデータを取得する機能
  - 存在するファイル（report.md、analysis.md等）からフェーズを判定する機能
  - _Requirements: 3.1, 6.3_

- [x] 1.3 バグファイル監視のIPCハンドラを実装
  - .kiro/bugs/ディレクトリのファイル変更を監視するwatcher
  - 変更イベントをRenderer Processに通知するIPC
  - watcher開始・停止のAPI
  - _Requirements: 6.5_

- [x] 2. bugStoreの実装
- [x] 2.1 bugStoreの基本状態管理を実装
  - bugs配列、selectedBugName、isLoading、errorの状態管理
  - loadBugs、selectBug、refreshBugsアクションの実装
  - electronAPI経由でバグ一覧を取得するロジック
  - specStoreと同様のパターンを踏襲
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [x] 2.2 bugStoreのファイル監視連携を実装
  - startWatching、stopWatchingアクションの実装
  - ファイル変更イベント受信時の自動更新ロジック
  - プロジェクト変更時のwatcher再設定
  - _Requirements: 6.5_

- [x] 2.3 bugStoreの単体テストを実装
  - loadBugs、selectBug、refreshBugsの動作検証
  - ファイル変更時の状態更新検証
  - エラーハンドリングの検証
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 3. BugProgressIndicatorコンポーネントの実装
- [x] 3.1 (P) 4段階進捗インジケーターを実装
  - Report→Analyze→Fix→Verifyの4ステップを水平表示
  - 完了フェーズは塗りつぶしアイコン、未完了はアウトライン表示
  - 現在フェーズをハイライト表示
  - Lucide Reactアイコンを使用したコンパクトなデザイン
  - _Requirements: 3.2, 3.3, 3.4_

- [x] 3.2* (P) BugProgressIndicatorの単体テストを実装
  - 各フェーズでの正しい表示状態を検証
  - 完了・未完了・現在フェーズの視覚的区別を検証
  - _Requirements: 3.2, 3.3, 3.4_

- [x] 4. BugListItemコンポーネントの実装
- [x] 4.1 バグ行表示コンポーネントを実装
  - バグ名、BugProgressIndicator、更新日時を表示
  - 選択状態のハイライトスタイル
  - クリックおよびキーボード操作での選択対応
  - _Requirements: 2.2, 3.2, 3.3, 3.4_

- [x] 5. BugActionButtonsコンポーネントの実装
- [x] 5.1 ワークフローアクションボタンを実装
  - Analyze、Fix、Verifyの3ボタンを表示
  - 現在フェーズに応じて次に実行可能なアクションのみ有効化
  - 実行中はローディングスピナーを表示しボタンを無効化
  - コンパクトなインラインボタンデザイン
  - _Requirements: 5.1, 5.5, 5.6_

- [x] 5.2 アクション実行ロジックを実装
  - agentStore経由で/kiro:bug-analyze、/kiro:bug-fix、/kiro:bug-verifyコマンドを送信
  - コマンド実行完了後のバグリスト更新
  - エラー発生時の通知表示
  - _Requirements: 5.2, 5.3, 5.4, 7.1, 7.2, 7.3, 7.4_

- [x] 5.3* BugActionButtonsの単体テストを実装
  - フェーズに応じたボタン有効化状態を検証
  - ローディング状態の表示を検証
  - ボタンクリック時のコマンド送信を検証
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x] 6. BugListコンポーネントの実装
- [x] 6.1 バグ一覧表示の基本機能を実装
  - bugStoreからバグ一覧を取得し表示
  - 各バグをBugListItemで描画
  - プロジェクト未選択時は「プロジェクトを選択してください」メッセージを表示
  - バグが存在しない場合は空状態メッセージを表示
  - _Requirements: 2.1, 2.4, 2.5_

- [x] 6.2 バグ選択と詳細表示を実装
  - バグクリック時にbugStore.selectBugを呼び出し
  - 選択されたバグの詳細をエディタパネルに表示する連携
  - 選択バグに対するBugActionButtonsの表示
  - _Requirements: 2.2, 2.3, 5.1_

- [x] 6.3* BugListの統合テストを実装
  - バグ一覧の表示とスクロールを検証
  - バグ選択と詳細表示連携を検証
  - 空状態とエラー状態の表示を検証
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 7. CreateBugDialogコンポーネントの実装
- [x] 7.1 バグ作成ダイアログの基本UIを実装
  - ダイアログの開閉制御
  - バグ名入力フィールド（必須）
  - バグ説明入力フィールド（テキストエリア、任意）
  - 作成・キャンセルボタン
  - _Requirements: 4.1, 4.2, 4.3_

- [x] 7.2 バグ作成ロジックを実装
  - バグ名が空の場合はエラーメッセージを表示し作成を阻止
  - agentStore経由で/kiro:bug-createコマンドを送信
  - 作成完了後にダイアログを閉じてbugStoreのリストを更新
  - 作成中はボタンをローディング状態に
  - _Requirements: 4.4, 4.5, 4.6, 7.1_

- [x] 7.3* CreateBugDialogの単体テストを実装
  - フォームバリデーション（空名のエラー）を検証
  - 作成ボタンクリック時のコマンド送信を検証
  - ダイアログの開閉動作を検証
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [x] 8. DocsTabsコンポーネントの実装
- [x] 8.1 タブ切り替え親コンポーネントを実装
  - Specs/Bugsの2タブを表示
  - タブクリックで対応するリスト（SpecList/BugList）を切り替え
  - 選択中タブのハイライト表示
  - タブ選択状態をローカルstateで管理し再描画時も維持
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 8.2 タブヘッダーに新規作成ボタンを統合
  - 既存のSpecListHeaderの新規作成機能をDocsTabsに統合
  - Specsタブ選択時は「新規Spec」ボタン、Bugsタブ選択時は「新規バグ」ボタンを表示
  - ボタンクリックで対応するダイアログを開く
  - _Requirements: 1.1, 1.2_

- [x] 8.3* DocsTabsの単体テストを実装
  - タブ切り替えの動作を検証
  - タブ状態の維持を検証
  - 新規作成ボタンの表示切り替えを検証
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 9. サイドバーの統合とレイアウト調整
- [x] 9.1 サイドバー構成をDocsTabsに移行
  - 既存のSpecListHeaderを削除またはDocsTabs内に統合
  - サイドバー内にDocsTabsを配置し、SpecListとBugListをタブで切り替え
  - GlobalAgentPanelの下部固定配置を維持
  - レイアウトとスクロールの調整
  - _Requirements: 1.1, 1.2, 2.1_

- [x] 9.2 Agentコマンド連携の最終確認
  - バグ関連コマンドがAgentに正しく送信されることを確認
  - Agent出力がログパネルに表示されることを確認
  - エラー発生時の通知が正しく表示されることを確認
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [x] 10. 統合テストとE2Eテスト
- [x] 10.1* BugList + bugStoreの統合テストを実装
  - バグ一覧表示、選択、更新の連携を検証
  - ファイル変更時の自動更新を検証
  - _Requirements: 2.1, 2.2, 2.3, 6.1, 6.3, 6.5_

- [x] 10.2* DocsTabsの統合テストを実装
  - Specs/Bugsタブ切り替えの動作を検証
  - タブ状態の維持を検証
  - 新規作成ダイアログの連携を検証
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 10.3* E2Eテストを実装
  - バグ作成フロー（ダイアログ→入力→作成→一覧更新）を検証
  - ワークフロー実行（Analyze→Fix→Verify）を検証
  - タブ切り替え（Specs↔Bugs）と状態保持を検証
  - _Requirements: 1.1, 1.2, 2.1, 4.1, 4.4, 4.6, 5.2, 5.3, 5.4_

---

## Requirements Coverage

| Requirement | Tasks |
|-------------|-------|
| 1.1 | 8.1, 8.2, 9.1, 10.2, 10.3 |
| 1.2 | 8.1, 8.2, 9.1, 10.2, 10.3 |
| 1.3 | 8.1, 10.2 |
| 1.4 | 8.1, 10.2 |
| 2.1 | 6.1, 9.1, 10.1, 10.3 |
| 2.2 | 4.1, 6.2, 6.3, 10.1 |
| 2.3 | 6.2, 6.3, 10.1 |
| 2.4 | 6.1, 6.3 |
| 2.5 | 6.1, 6.3 |
| 3.1 | 1.1, 1.2 |
| 3.2 | 3.1, 3.2, 4.1 |
| 3.3 | 3.1, 3.2, 4.1 |
| 3.4 | 3.1, 3.2, 4.1 |
| 4.1 | 7.1, 7.3, 10.3 |
| 4.2 | 7.1, 7.3 |
| 4.3 | 7.1, 7.3 |
| 4.4 | 7.2, 7.3, 10.3 |
| 4.5 | 7.2, 7.3 |
| 4.6 | 7.2, 7.3, 10.3 |
| 5.1 | 5.1, 5.3, 6.2 |
| 5.2 | 5.2, 5.3, 10.3 |
| 5.3 | 5.2, 5.3, 10.3 |
| 5.4 | 5.2, 5.3, 10.3 |
| 5.5 | 5.1, 5.3 |
| 5.6 | 5.1, 5.3 |
| 6.1 | 1.1, 2.1, 2.3, 10.1 |
| 6.2 | 2.1, 2.3 |
| 6.3 | 1.2, 2.1, 2.3, 10.1 |
| 6.4 | 2.1, 2.3 |
| 6.5 | 1.3, 2.2, 2.3, 10.1 |
| 7.1 | 5.2, 7.2, 9.2 |
| 7.2 | 5.2, 9.2 |
| 7.3 | 5.2, 9.2 |
| 7.4 | 5.2, 9.2 |
