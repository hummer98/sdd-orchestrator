# Response to Document Review #3

**Feature**: git-worktree-support
**Review Date**: 2026-01-14
**Reply Date**: 2026-01-14

---

## Response Summary

| Severity | Issues | Fix Required | No Fix Needed | Needs Discussion |
| -------- | ------ | ------------ | ------------- | ---------------- |
| Critical | 1      | 0            | 0             | 1                |
| Warning  | 2      | 2            | 0             | 0                |
| Info     | 2      | 0            | 2             | 0                |

---

## Response to Critical Issues

### C-1.1: spec.jsonのphaseが`inspection-complete`だがTask 14-15が未完了

**Issue**: spec.jsonのphaseが`inspection-complete`だが、tasks.mdのTask 14-15（Requirement 9: Impl開始UIの分岐）が未完了。inspection-2.mdにTask 14-15の検証結果が含まれていない。

**Judgment**: **Needs Discussion** ⚠️

**Evidence**:

現状の確認結果:
- `spec.json`: phase = `inspection-complete`, documentReview.status = `approved`
- `tasks.md`: Task 14.1-14.4, Task 15.1-15.2 が `[ ]` (未完了)
- `inspection-2.md`: Task 1-13のみ検証、Task 14-15の検証結果なし

この不整合には以下の2つの解釈が可能:

**解釈1: Task 14-15は後から追加された要件**
- inspection-2（2026-01-13）実施時点ではTask 13までが実装範囲だった
- その後、Requirement 9とTask 14-15が追加された
- phaseを`implementation`に戻してTask 14-15を実装する必要がある

**解釈2: Requirement 9は意図的にスコープ外とされた**
- 初期リリースではworktree作成を自動で行い、選択UIは不要と判断された
- requirements.md、design.md、tasks.mdからRequirement 9関連を削除する必要がある

**Discussion Required**:
- Requirement 9（Impl開始UIの2ボタン選択）は初期リリースに必要か？
- 現状の「worktree自動作成」で十分か、ユーザー選択UIが必要か？

---

## Response to Warnings

### W-2.1: Task 14.3のIPCチャンネル定義不明確

**Issue**: Task 14.3に「WORKTREE_IMPL_START IPCチャネルの登録と接続」と記載があるが、design.mdのIPC Handlers拡張セクション（L457-462）には`worktree:impl-start`チャンネルが未定義。

**Judgment**: **Fix Required** ✅

**Evidence**:

`design.md` L457-462のIPCチャンネル一覧:
```
worktree:check-main
worktree:create
worktree:remove
worktree:resolve-path
```

一方、`design.md` L503には以下の依存関係が記載:
```
Outbound: IPC Handler - worktree:impl-start呼び出し (P0)
```

`tasks.md` Task 14.3:
```
WORKTREE_IMPL_START IPCチャネルの登録と接続
```

設計上、`worktree:impl-start`チャンネルが必要と思われるが、IPC Handlers拡張セクションのContract表に定義されていない。

**Action Items**:
- design.md L462に`worktree:impl-start`チャンネルのContract定義を追加

---

### W-3.1: IPCチャンネル命名の不整合

**Issue**: design.mdでは「worktree:impl-start」、tasks.mdでは「WORKTREE_IMPL_START」と命名が異なる。

**Judgment**: **Fix Required** ✅

**Evidence**:

- `design.md` L503: `worktree:impl-start呼び出し`（kebab-case）
- `tasks.md` Task 14.3: `WORKTREE_IMPL_START IPCチャネル`（SCREAMING_SNAKE_CASE）

既存の実装パターン（`worktree:check-main`, `worktree:create`等）に合わせ、`worktree:impl-start`（kebab-case）に統一すべき。

**Action Items**:
- tasks.md Task 14.3の「WORKTREE_IMPL_START」を「worktree:impl-start」に修正

---

## Response to Info (Low Priority)

| #    | Issue                               | Judgment      | Reason                                                |
| ---- | ----------------------------------- | ------------- | ----------------------------------------------------- |
| I-2.1 | worktree作成中のローディング表示未定義 | No Fix Needed | UX改善項目として将来対応可能、初期リリースでは必須ではない |
| I-2.2 | 操作手順未更新                       | No Fix Needed | 実装完了後に対応予定と理解、仕様ドキュメント修正は不要     |

---

## Files to Modify

| File | Changes |
| ---- | ------- |
| design.md | L462に`worktree:impl-start`チャンネルのContract定義を追加 |
| tasks.md | Task 14.3の「WORKTREE_IMPL_START」を「worktree:impl-start」に修正 |

---

## Conclusion

**解決済み**:
- W-2.1, W-3.1: design.mdとtasks.mdの命名不整合は修正可能

**Discussion Required**:
- C-1.1: Requirement 9（Impl開始UIの分岐）を初期リリースに含めるかの判断が必要

**次のステップ**:
1. C-1.1について、以下のいずれかの方針を決定:
   - **Option A**: phaseを`implementation`に戻し、Task 14-15を実装
   - **Option B**: Requirement 9をスコープ外とし、requirements.md/design.md/tasks.mdから削除
2. 方針決定後、W-2.1/W-3.1の修正を適用

---

_This reply was generated by the document-review-reply command._

---

## Applied Fixes

**Applied Date**: 2026-01-14
**Applied By**: --fix

### Summary

| File | Changes Applied |
| ---- | --------------- |
| design.md | `worktree:impl-start` IPCチャンネルをContract表に追加 |
| tasks.md | Task 14.3のIPCチャンネル名をkebab-caseに統一 |

### Details

#### design.md

**Issue(s) Addressed**: W-2.1

**Changes**:
- IPC Handlers拡張セクションのAPI Contract表に `worktree:impl-start` チャンネルを追加

**Diff Summary**:
```diff
 | invoke | worktree:resolve-path | `{ projectPath: string; relativePath: string }` | `{ absolutePath: string }` | - |
+| invoke | worktree:impl-start | `{ projectPath: string; featureName: string; useWorktree: boolean }` | `{ success: boolean; worktreeInfo?: WorktreeInfo }` | NOT_ON_MAIN_BRANCH, WORKTREE_EXISTS, GIT_ERROR |
```

#### tasks.md

**Issue(s) Addressed**: W-3.1

**Changes**:
- Task 14.3の「WORKTREE_IMPL_START」を「worktree:impl-start」に修正（既存のIPCチャンネル命名規則に統一）

**Diff Summary**:
```diff
-- [ ] 14.3 「Worktreeで実装」ボタンの処理を実装
-  - WORKTREE_IMPL_START IPCチャネルの登録と接続
+- [ ] 14.3 「Worktreeで実装」ボタンの処理を実装
+  - worktree:impl-start IPCチャネルの登録と接続
```

---

_Fixes applied by document-review-reply command._
