# Implementation Plan

## Tasks

- [x] 1. レイアウト設定サービスの実装
- [x] 1.1 (P) Zodスキーマとデフォルト値の定義
  - レイアウト設定のバリデーションスキーマを作成
  - versionフィールド(固定値1)とlayoutオブジェクトを含む構造を定義
  - 左ペイン幅、右ペイン幅、下部ペイン高さ、Agent一覧高さのデフォルト値を設定
  - 各サイズ値は0以上の数値として検証
  - _Requirements: 4.2, 4.3, 4.4, 5.1, 5.3_

- [x] 1.2 レイアウト設定のファイル読み書き機能を実装
  - プロジェクトパスから設定ファイルパスを構築するロジックを実装
  - 設定ファイルの読み込み機能を実装（ファイル不在時はnull返却）
  - Zodによるバリデーションを適用し、不正なデータ時はログ記録してnull返却
  - 設定ファイルへの保存機能を実装（JSON形式で整形出力）
  - デフォルト値でリセットする機能を実装
  - 単体テスト: ファイル読み書き、バリデーション、デフォルト値取得のテストを作成
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.2, 4.1_

- [x] 2. IPC通信層の拡張
- [x] 2.1 (P) IPCチャンネル定義の追加
  - レイアウト読み込み用チャンネルを定義
  - レイアウト保存用チャンネルを定義
  - レイアウトリセット用チャンネルを定義
  - メニューからのリセットイベント用チャンネルを定義
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 2.2 IPCハンドラの実装
  - レイアウト読み込みハンドラを実装（サービス層を呼び出し）
  - レイアウト保存ハンドラを実装（サービス層を呼び出し）
  - レイアウトリセットハンドラを実装（サービス層を呼び出し）
  - タスク1.2のサービス実装に依存
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 2.3 Preload APIの公開
  - レイアウト読み込みAPIをrendererに公開
  - レイアウト保存APIをrendererに公開
  - レイアウトリセットAPIをrendererに公開
  - メニューリセットイベントのリスナー登録APIを公開
  - TypeScript型定義を更新
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 3. UI層の拡張
- [x] 3.1 ResizeHandleコンポーネントの拡張
  - リサイズ完了イベントのコールバックプロパティを追加
  - マウスアップ時にコールバックを呼び出す処理を実装
  - 既存のリサイズ動作を維持
  - _Requirements: 1.1_

- [x] 3.2 Appコンポーネントのレイアウト保存機能を実装
  - デフォルト値定数を共通利用するよう変更
  - リサイズ完了時に設定を保存する関数を実装
  - 各ResizeHandleにonResizeEndコールバックを接続
  - エラー発生時はログ記録のみでUIを継続
  - _Requirements: 1.1, 1.2, 1.3, 5.2, 5.3_

- [x] 3.3 Appコンポーネントのレイアウト復元機能を実装
  - プロジェクト選択時に設定を読み込む処理を実装
  - 読み込んだ値で各ペインサイズを更新
  - ファイル不在時はデフォルト値を使用
  - 読み込みエラー時はログ記録してデフォルト値を適用
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 5.2_

- [x] 4. メニューからのリセット機能
- [x] 4.1 (P) 表示メニューへのリセット項目追加
  - 「表示」メニュー内に「レイアウトをリセット」項目を追加
  - プロジェクト選択時のみ有効化
  - クリック時にrendererへイベントを送信
  - _Requirements: 3.1, 3.3_

- [x] 4.2 Appコンポーネントでのリセットイベント処理
  - メニューイベントリスナーを登録
  - リセット時にすべてのペインをデフォルト値に戻す
  - リセット後の値を設定ファイルに保存
  - コンポーネントアンマウント時にリスナーを解除
  - _Requirements: 3.1, 3.2_

- [x] 5. 統合テストと動作確認
- [x] 5.1 レイアウト永続化の統合テスト
  - ペインリサイズ後に設定ファイルが生成されることを確認
  - 設定ファイルの内容がJSON形式で正しいことを検証
  - プロジェクト再選択時に設定が復元されることを確認
  - レイアウトリセット後にデフォルト値が適用されることを確認
  - エラー時にアプリがクラッシュせず動作継続することを確認
  - _Requirements: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 4.1, 5.1, 5.2_
