# 仕様検討記録

> **注意**: 本ドキュメントは検討段階の記録です。最終仕様は [design.md](./design.md) を参照してください。

## 基本情報
- **作成日**: 2025-12-20
- **機能名**: pane-layout-persistence

## 初期要求
ユーザーから「プロジェクト毎にウィンドウ内のそれぞれのペインサイズは記憶されていますか」という質問があり、調査の結果、現状では記憶されていないことが判明。この機能の追加を検討。

## 質疑応答

### Q1. 保存場所について
**質問**:
- 1-1. プロジェクト毎の設定を保存する場所はあるか？（.sdd のような）

**回答**:
- 1-1: 現状、プロジェクト毎の設定保存場所は存在しない。`electron-store` はアプリ全体の設定のみ。

### Q2. 保存方法の選択肢
**質問**:
- 2-1. `.kiro/ui-config.json` - プロジェクト内に保存
- 2-2. `electron-store` に `projectSettings` 構造を追加 - アプリ側で一元管理
- 2-3. `.sdd/` のような新しいディレクトリ

**回答**:
- ユーザーから `.kiro/sdd-orchestrator.json` の提案があり採用

### Q3. フォールバックについて
**質問**:
- 3-1. 両方サポート（プロジェクト内優先 → `electron-store` フォールバック）
- 3-2. プロジェクト内のみ

**回答**:
- 3-2: フォールバックなし。設定がなければデフォルト値を使用。

### Q4. ファイル作成タイミング
**質問**:
- 4-A. 初回リサイズ時
- 4-B. プロジェクト選択時
- 4-C. アプリ終了時（変更があれば）

**回答**:
- 4-A: 初回リサイズ時に作成

### Q5. リセット機能
**質問**:
- 5-1. メニュー「表示」→「レイアウトをリセット」を今回のスコープに含めるか

**回答**:
- 5-1: 含める

## 調査・検討結果

### 現状の実装
- [App.tsx:86-89](electron-sdd-manager/src/renderer/App.tsx#L86-L89): ペインサイズは `useState` でハードコードされた初期値を使用
- `ResizeHandle.tsx`: リサイズ機能自体は動作するが、永続化されない
- `configStore.ts`: アプリ全体の設定（`recentProjects`, `windowBounds`, `hangThreshold`）を保存

### 保存場所の比較検討
| 選択肢 | メリット | デメリット |
|--------|----------|------------|
| `.kiro/ui-config.json` | プロジェクトと一緒に移動可能 | SDDの仕様管理とUI設定が混在 |
| `electron-store` で一元管理 | プロジェクトを汚さない | PC間で設定が移行されない |
| `.kiro/sdd-orchestrator.json` | アプリ名が明確、拡張性あり、競合リスク低 | Git管理の判断が必要 |

## 決定事項

| 項目 | 内容 |
|------|------|
| 保存場所 | `.kiro/sdd-orchestrator.json` |
| フォールバック | なし（設定がなければデフォルト値） |
| 保存対象 | `leftPaneWidth`, `rightPaneWidth`, `bottomPaneHeight`, `agentListHeight` |
| ファイル作成タイミング | 初回リサイズ時 |
| 保存タイミング | リサイズ完了時（即座に保存） |
| リセット機能 | 「表示」→「レイアウトをリセット」 |

### ファイル形式
```json
{
  "version": 1,
  "layout": {
    "leftPaneWidth": 320,
    "rightPaneWidth": 400,
    "bottomPaneHeight": 250,
    "agentListHeight": 180
  }
}
```

### 動作フロー
1. プロジェクト選択時 → ファイルがあれば読み込み、なければデフォルト値を使用
2. ペインをリサイズ → `.kiro/sdd-orchestrator.json` を作成/更新
3. 「表示」→「レイアウトをリセット」→ `layout` セクション削除 + デフォルト値適用

## 備考
- `.kiro/` が存在しないプロジェクトでは設定保存されない（SDDプロジェクトのみ対象）
- Gitにコミットするかはユーザー判断（`.gitignore` への追加は任意）
