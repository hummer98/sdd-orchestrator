description = "Review spec documents for consistency, gaps, and alignment with steering"

prompt = '''
# Spec Document Review

Review specification documents for consistency, identify contradictions, gaps, and ambiguities, then generate a comprehensive report.

**Output Language**: Follow the language configuration in GEMINI.md or the project's default language.

## Target Feature

{{args}}

## Documents to Review

### Spec Documents

@{.kiro/specs/{{args}}/spec.json}
@{.kiro/specs/{{args}}/requirements.md}
@{.kiro/specs/{{args}}/design.md}
@{.kiro/specs/{{args}}/tasks.md}

### Steering Documents

@{.kiro/steering/product.md}
@{.kiro/steering/tech.md}
@{.kiro/steering/structure.md}

## Review Process

Conduct review from the following perspectives:

### 1. Spec Document Consistency Check

**Requirements - Design Alignment**:
- All requirements covered in Design
- Design features traced back to requirements
- Requirement ID traceability

**Design - Tasks Alignment**:
- All Design components reflected in Tasks
- Task implementation items consistent with Design
- Technology choice consistency

**Acceptance Criteria - Tasks Coverage (CRITICAL CHECK)**:
1. Extract all criterion IDs from requirements.md (format: X.Y, e.g., 7.1, 7.2)
2. For each criterion:
   - Find corresponding task(s) in tasks.md
   - Classify each task as Infrastructure (preparation) or Feature (implementation)
   - Verify user-facing criteria have Feature tasks

### 2. Gap Detection

**Technical Considerations**:
- Error handling coverage
- Security considerations
- Performance requirements
- Testing strategy

**Operational Considerations**:
- Deployment procedures
- Rollback strategy
- Monitoring/logging

### 3. Ambiguity Extraction

- Vague descriptions
- Undefined dependencies
- Pending decisions

### 4. Steering Alignment Check

- Architecture compatibility
- Technology stack/convention compliance
- Naming convention/directory structure adherence

## Generate Report

Determine review number:
1. Search for `document-review-*.md` files in `.kiro/specs/{{args}}/`
2. Get maximum existing review number
3. Determine next sequential number (start with `1` if none exist)

Report file: `.kiro/specs/{{args}}/document-review-{n}.md`

### Report Structure

```markdown
# Specification Review Report #{n}

**Feature**: {feature-name}
**Review Date**: {YYYY-MM-DD}
**Documents Reviewed**: {list of reviewed files}

## Executive Summary

{Review result summary: Critical/Warning/Info counts}

## 1. Document Consistency Analysis

### 1.1 Requirements - Design Alignment
{Contradictions and gaps detail}

### 1.2 Design - Tasks Alignment
{Contradictions and gaps detail}

### 1.3 Acceptance Criteria - Tasks Coverage
{CRITICAL CHECK: Ensure every criterion has Feature Implementation tasks}

## 2. Gap Analysis
{List of technical and operational gaps}

## 3. Ambiguities and Unknowns
{List of vague descriptions and undefined items}

## 4. Steering Alignment
{Analysis of alignment with existing architecture}

## 5. Recommendations

### Critical Issues (Must Fix)
{List of critical issues}

### Warnings (Should Address)
{List of issues that should be addressed}

### Suggestions (Nice to Have)
{List of improvement suggestions}

## 6. Action Items

| Priority | Issue | Recommended Action | Affected Documents |
| -------- | ----- | ------------------ | ------------------ |
| ...      | ...   | ...                | ...                |

---
_This review was generated by the document-review command._
```

## Output

After review completion, display:
1. **Report Location**: `.kiro/specs/{{args}}/document-review-{n}.md`
2. **Review Summary**: Critical/Warning/Info counts
3. **Next Action**: Run `/kiro:document-review-reply {{args}} {n}` to respond to issues
'''
