---
description: 仕様検討
allowed-tools: Read, Write, WebSearch, WebFetch, Glob, Grep, Task, SlashCommand
---

# 仕様検討ワークフロー

<background_information>
- **Mission**: ユーザーのアイデアや要求を整理・検討し、Spec-Driven Development（SDD）のワークフローにつなげる
- **Goal**: `/kiro:spec-init` を実行できる状態にする
- **Success Criteria**:
  - ユーザーの要求が明確化されている
  - 実現可能性が検討されている
  - SDDワークフローへの適切なルートが決定されている
</background_information>

<instructions>
## ⚠️ 重要な制約

- **Claude CodeのPlan Mode（EnterPlanMode）は使用しない**
- **実装は行わない** - 仕様検討フェーズのみ
- ゴールは `/kiro:spec-init` の実行
- **推測・予見に頼らない** - 不明点は必ず質問する

## ワークフロー

### Phase 1: 要求の理解と質問

**⚠️ 最重要**: ユーザーが「質問はありますか」と聞いていなくても、**積極的に質問すること**。推測で進めない。

1. **ユーザーの入力を分析**
   - 何を実現したいのか
   - どのような問題を解決したいのか
   - 期待する成果物は何か

2. **不明点の洗い出しと質問**

   以下の観点で不明点がないか確認し、**1つでも不明点があれば必ず質問する**：

   - **スコープ**: 機能の範囲は明確か？境界線はどこか？
   - **ユーザー**: 誰が使うのか？どのような操作を期待しているか？
   - **技術的制約**: 使用すべき技術、避けるべき技術はあるか？
   - **既存システムとの関係**: どこに統合されるか？影響範囲は？
   - **優先度**: 必須機能と nice-to-have の区別は？
   - **非機能要件**: パフォーマンス、セキュリティ、アクセシビリティの要件は？

3. **質問の出力形式**

   質問は**番号・枝番**を付けて、ユーザーが回答しやすい形式にする：

   ```
   ## 確認事項

   仕様を明確にするため、以下について教えてください：

   ### 1. スコープについて
   1-1. [質問]
   1-2. [質問]

   ### 2. 技術的な制約について
   2-1. [質問]

   ### 3. 優先度について
   3-1. [質問]
   3-2. [質問]

   ---
   回答例: 「1-1: ○○、1-2: △△、2-1: 特になし、3-1: ...」
   ```

   **回答形式の案内を必ず含める** - ユーザーが番号で簡潔に回答できるようにする。

**注意**: 質問への回答を得てから Phase 2 に進む。回答なしに推測で進めない。

### Phase 2: 調査・検討

必要に応じて以下を実施：

1. **既存コードベースの調査**
   - 関連する既存機能の確認
   - 影響範囲の把握
   - 再利用可能なコンポーネントの特定

2. **技術調査**（必要な場合）
   - WebSearchで技術的なベストプラクティスを調査
   - 類似実装のパターンを調査

3. **実現可能性の検討**
   - 技術的な課題の洗い出し
   - 代替アプローチの検討

### Phase 3: 仕様の整理

1. **プロジェクト説明文の作成**
   - SDDのinput（`<project-description>`）となる簡潔な説明文を作成
   - 1-3文で機能の概要を記述

2. **ワークフローの決定**

   | 条件 | 推奨コマンド |
   |------|-------------|
   | 機能追加・改善 | `/kiro:spec-init "説明"` → 標準ワークフロー |
   | バグ修正（設計変更なし） | `/kiro:bug-create` |

### Phase 4: 仕様検討結果の提示

以下の形式で出力：

```
## 仕様検討結果

### プロジェクト概要
[1-2文で要約]

### 検討内容
- [調査・検討した内容のサマリー]

### 推奨アプローチ
[推奨するワークフローとその理由]

### 備考
[注意点や追加検討事項があれば記載]

---
上記の内容で `/kiro:spec-init` を実行してよろしいですか？
```

### Phase 5: Spec 初期化の実行

**ユーザーの承認を得てから**、SlashCommand ツールで `/kiro:spec-init "プロジェクト説明"` を実行する。

- 承認が得られた場合: `/kiro:spec-init` を実行 → Phase 6 へ
- 修正の指示があった場合: 指示に従って Phase 3-4 を再実行
- 拒否された場合: 終了

### Phase 6: 仕様検討記録の保存

`/kiro:spec-init` 完了後、Write ツールで `.kiro/specs/<feature-name>/planning.md` を作成し、問答の記録を保存する。

**ファイル形式**:

```markdown
# 仕様検討記録

## 基本情報
- **作成日**: YYYY-MM-DD
- **機能名**: <feature-name>

## 初期要求
[ユーザーの最初の入力内容]

## 質疑応答

### Q1. [質問カテゴリ]
**質問**:
- 1-1. [質問内容]
- 1-2. [質問内容]

**回答**:
- 1-1: [回答内容]
- 1-2: [回答内容]

### Q2. [質問カテゴリ]
...

## 調査・検討結果
- [調査した内容のサマリー]
- [技術的な検討事項]

## 決定事項
- [確定した仕様や方針]

## 備考
- [追加の注意点や将来の検討事項]
```

**注意**: 問答の内容を正確に記録し、後から参照できるようにする。

</instructions>

## Tool Guidance

- **Read/Glob/Grep**: 既存コードベースの調査
- **WebSearch/WebFetch**: 技術調査、ベストプラクティスの確認
- **Task**: 広範囲な調査が必要な場合（Exploreエージェント）
- **SlashCommand**: `/kiro:spec-init` を実行
- **Write**: `planning.md` の作成（Phase 6）

## Safety & Fallback

- **要求が不明確**: 必ず質問して明確化する（**推測で進めない**）
- **少しでも曖昧な点がある**: 質問する（「たぶんこうだろう」で進めない）
- **スコープが大きすぎる**: 分割を提案し、優先順位を質問する
- **バグ修正の場合**: `/kiro:bug-create` を案内する
- **既存Specがある場合**: 重複を避け、既存Specの活用を提案する

## 質問についての原則

1. **質問は歓迎される行為** - ユーザーは正確な仕様策定を望んでいる
2. **推測のコストは高い** - 間違った前提で進むと後戻りが発生する
3. **質問は1回にまとめる** - 複数の不明点は一度に質問する
4. **質問の粒度** - 抽象的すぎず、具体的すぎない適切なレベルで質問する
