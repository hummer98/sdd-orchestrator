#!/bin/bash

# SDD Orchestrator CLI
# Usage: sdd [path]
#   sdd             - Open current directory
#   sdd .           - Open current directory
#   sdd /path/to   - Open specified path

set -e

# IMPORTANT: Unset ELECTRON_RUN_AS_NODE for Electron-based IDEs
unset ELECTRON_RUN_AS_NODE

# Find the installed app
APP_PATH="/Applications/SDD Orchestrator.app"

if [ ! -d "$APP_PATH" ]; then
    echo "Error: SDD Orchestrator.app not found in /Applications/"
    echo "Please install the app first."
    exit 1
fi

# 引数処理
TARGET_PATH=""
if [ -n "$1" ]; then
    # 相対パスを絶対パスに変換
    if [[ "$1" = /* ]]; then
        TARGET_PATH="$1"
    else
        TARGET_PATH="$(cd "$1" 2>/dev/null && pwd)" || {
            echo "Error: Directory '$1' does not exist"
            exit 1
        }
    fi
else
    # 引数が指定されていない場合はカレントディレクトリを使用
    TARGET_PATH="$(pwd)"
fi

# アプリを起動
# macOSのopen -aコマンドでは --args を使って引数を渡す
open -a "$APP_PATH" --args "$TARGET_PATH"
